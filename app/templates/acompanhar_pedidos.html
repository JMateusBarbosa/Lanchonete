{% extends "layouts/base.html" %}

{% block title %}Acompanhar Pedidos{% endblock %}

{% block additional_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/acompanhar_pedidos.css') }}">
{% endblock %}

{% block content %}
<h1 class="page-title">Acompanhar Pedidos</h1>
<!-- Notificações em Tempo Real -->


<!-- Barra de Ferramentas Superior -->
<div class="toolbar">
    <div class="search-bar">
        <input type="text" id="search" placeholder="Buscar por pedido, mesa ou cliente...">
    </div>
    <div class="filters">
        <select id="filter-status">
            <option value="all">Todos</option>
            <option value="pending">Pendentes</option>
            <option value="completed">Concluídos</option>
        </select>
        <select id="filter-time">
            <option value="all">Todos os tempos</option>
            <option value="30m">Últimos 30 minutos</option>
            <option value="1h">Última hora</option>
            <option value="today">Hoje</option>
        </select>
    </div>
    <div class="update-controls">
        <button id="refresh-button">Atualizar</button>
        <div class="auto-refresh">
            <input type="checkbox" id="auto-refresh" checked>
            <label for="auto-refresh">Atualização automática</label>
        </div>
    </div>
</div>
<div id="notifications" style="display: none;" class="notification"></div> <!-- Adiciona este elemento logo após o h1 -->

<!-- Tabela de Pedidos -->
<table class="orders-table">
    <thead>
        <tr>
            <th>Hora</th>
            <th>Nome do Cliente</th>
            <th>Número da Mesa</th>
            <th>Itens</th>
            <th>Quantidade</th>
            <th>Status</th>
            <th>Ações</th> 
        </tr>
    </thead>
    <tbody>
        {% for pedido in pedidos %}
        <tr class="order-row" data-pedido-id="{{ pedido.id_pedido }}" data-status="{{ pedido.status }}">
            <td>{{ pedido.data_pedido.strftime('%H:%M') }}</td>
            <td>{{ pedido.nome_cliente }}</td>
            <td>{{ pedido.numero_mesa if pedido.numero_mesa else '—' }}</td>
            <td>
                {% for item_pedido in pedido.itens_pedido %}
                    {{ item_pedido.item.nome_item }}<br>
                {% endfor %}
            </td>
            <td>
                {% for item_pedido in pedido.itens_pedido %}
                    {{ item_pedido.quantidade }}<br>
                {% endfor %}
            </td>

            <!-- Exibir o status atual -->
            <td class="status-cell">
                {{ pedido.status }} <!-- Mostrar o status atual do pedido -->
            </td>

            <!-- Botão para alterar status -->
            <td>
                <!-- Botão de conclusão de pedido -->
                <button class="btn-complete" data-pedido-id="{{ pedido.id_pedido }}">Concluir Pedido</button>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="{{ url_for('static', filename='js/acompanhar_pedido.js') }}"></script>
{% endblock %}
